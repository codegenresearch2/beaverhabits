from nicegui import ui
from beaverhabits.frontend.components import (
    HabitAddButton,
    HabitDeleteButton,
    HabitNameInput,
    HabitStarCheckbox,
)
from beaverhabits.frontend.layout import layout
from beaverhabits.storage.storage import HabitList

grid_classes = "w-full gap-0 items-center"

def validate_habit_name(name):
    # Add your input validation logic here
    # For example, you can check if the name is not empty and does not contain special characters
    if not name or any(char in name for char in ['!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '-', '_', '+', '=', '{', '}', '[', ']', '|', '\\', ':', ';', '<', '>', '?', '/']):
        raise ValueError("Invalid habit name")

@ui.refreshable
def add_ui(habit_list: HabitList):
    for index, item in enumerate(habit_list.habits):
        with ui.grid(columns=9, rows=1).classes(grid_classes):
            name = HabitNameInput(item)
            name.classes("col-span-7 break-all")
            name.on('blur', lambda e: validate_habit_name(e.value))

            star = HabitStarCheckbox(item, add_ui.refresh)
            star.props("flat fab-mini color=grey")
            star.classes("col-span-1")

            delete = HabitDeleteButton(item, habit_list, add_ui.refresh)
            delete.props("flat fab-mini color=grey")
            delete.classes("col-span-1")

def add_page_ui(habit_list: HabitList):
    with layout():
        with ui.column().classes("w-full pl-1 items-center"):
            add_ui(habit_list)

            with ui.grid(columns=9, rows=1).classes(grid_classes):
                add = HabitAddButton(habit_list, add_ui.refresh)
                add.classes("col-span-7")

# Custom order for habits can be implemented by sorting the habit_list.habits list before iterating over it in the add_ui function